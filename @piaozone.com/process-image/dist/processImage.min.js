!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.processImage=t():e.processImage=t()}(window,(function(){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){var a=r(1),n=r(2).default,i=r(3).compressImgFile;e.exports={adjustSize:a.adjustSize,loadImage:a.loadImage,base64ToFile:a.base64ToFile,normalize:a.normalize,getRotateRect:a.getRotateRect,cuteImage:a.cuteImage,markImage:a.markImage,sortByRegion:a.sortByRegion,OperateCanvas:n,compressImgFile:i}},function(e,t,r){"use strict";function a(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r,a,n,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(a,n)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var i=e.apply(t,r);function o(e){s(i,a,n,o,c,"next",e)}function c(e){s(i,a,n,o,c,"throw",e)}o(void 0)}))}}function l(e,t,r,a){var n=parseFloat(r/e),i=parseFloat(a/t),o=parseFloat(e/t);return(e>r||t>a)&&(n<i?(e=r,t=Math.floor(e/o)):e=(t=a)*o),{width:e,height:t,rate:o}}function g(e){return new Promise((function(t){var r=new Image;r.onload=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({errcode:"0000",data:{imgObj:r,width:r.width,height:r.height}});case 1:case"end":return e.stop()}}),e)}))),r.onerror=function(){t({errcode:"2000",description:"加载图像失败"})},r.src=e}))}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t=t||"temp_"+ +new Date+"_"+Math.random().toString().replace(/0\./,"")+".jpg";for(var r=e.split(","),a=r[0].match(/:(.*?);/)[1],n=a.split("/")[1],i=atob(r[1]),o=i.length,c=new Uint8Array(o);o--;)c[o]=i.charCodeAt(o);if(t=t.split(".")[0],window.File&&"function"==typeof window.File){var s=new File([c],"".concat(t,".").concat(n),{type:a});return{errcode:"0000",data:s}}try{var u=new Blob([c],{type:a});return u.lastModifiedDate=new Date,u.name="".concat(t,".").concat(n),{errcode:"0000",data:u}}catch(e){return console.error(e),{errcode:"90002",description:"base64转换为图片异常，请检查图片是否正常"}}}function h(e){return p.apply(this,arguments)}function p(){return(p=u(regeneratorRuntime.mark((function e(t){var r,a,n,i,o,c,s,u,h,p,d,m,v,b,w,y,x,R,I,O,j,k,D,P,F=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=F.length>1&&void 0!==F[1]?F[1]:{},a=URL.createObjectURL(t),e.next=4,g(a);case 4:if("0000"===(n=e.sent).errcode){e.next=7;break}return e.abrupt("return",n);case 7:if(i=r.maxWidth,o=void 0===i?1920:i,c=r.maxHeight,s=void 0===c?1080:c,u=r.quality,h=void 0===u?.95:u,p=r.toType,d=void 0===p?"base64":p,m=r.filename,v=void 0===m?"":m,b=n.data,w=b.width,y=b.height,x=b.imgObj,R=l(w,y,o,s),I=R.width,O=R.height,j="",e.prev=13,(k=document.createElement("canvas")).width=I,k.height=O,(D=k.getContext("2d")).clearRect(0,0,I,O),D.drawImage(x,0,0,I,O),j=k.toDataURL("image/jpeg",h),"base64"!==d){e.next=23;break}return e.abrupt("return",{errcode:"0000",data:{imageWidth:I,imageHeight:O,base64:j}});case 23:e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(13),console.error(e.t0),e.abrupt("return",{errcode:"90001",description:"图片转换异常, 请检查图片是否正常"});case 29:return e.next=31,f(j,v);case 31:if("0000"===(P=e.sent).errcode){e.next=34;break}return e.abrupt("return",P);case 34:return e.abrupt("return",{errcode:"0000",data:{imageWidth:I,imageHeight:O,file:P.data}});case 35:case"end":return e.stop()}}),e,null,[[13,25]])})))).apply(this,arguments)}function d(e,t,r,a,n){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,o=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,s=parseFloat(Math.PI/180),u=Math.cos,l=Math.sin,g=parseFloat(t/r);e=Math.abs(e);var f=a-i,h=n-i,p=t,d=r;return 0===(e%=360)||180===e?(f=a,h=n):90===e||270===e?(f=n,h=a):e>0&&e<90||e>180&&e<270?(f=a*u(e*s)+n*l(e*s),h=n*u(e*s)+a*l(e*s)):(e>90&&e<180||e>270&&e<360)&&(f=n*u(e*s)+a*l(e*s),h=a*u(e*s)+n*l(e*s)),o&&c&&(t<o||r<c)&&(r<c?p=g*(d=c):d=(p=o)/g),(p>f||d>h)&&(p>d?p=g*(d=h):d=(p=f)/g,p>f?d=(p=f)/g:d>h&&(p=(d=h)*g)),{rw:p,rh:d}}function m(e,t){return v.apply(this,arguments)}function v(){return(v=u(regeneratorRuntime.mark((function e(t,r){var a,n,i,o,c,s,u,l,g,f,h,p,d,m,v,b,w,y,x,R,I,O,j,k,D,P,F;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.pixel,n=void 0===a?"":a,i=r.region,o=void 0===i?"":i,c=r.maxWidth,s=void 0===c?1920:c,u=r.maxHeight,l=void 0===u?1080:u,""!==o){e.next=3;break}return e.abrupt("return",{errcode:"0000",data:t});case 3:if(g=t.width,f=t.height,o&&n?(v=n.split(","),b=parseInt(v[0]),w=parseInt(v[1]),(g>f&&b<w||g<f&&b>w)&&(b=parseInt(v[1]),w=parseInt(v[0])),y=parseFloat(g/b),x=parseFloat(f/w),R=o.replace(/[\[\]]/g,"").split(","),h=parseInt(R[0])*y,p=parseInt(R[1])*x,d=parseInt(R[2])*y-h,m=parseInt(R[3])*x-p):(h=0,p=0,d=g,m=f),I=parseFloat(d/m),O=d,j=m,"function"==typeof(k=document.createElement("canvas")).getContext){e.next=12;break}return e.abrupt("return",{errcode:"unsport",description:"浏览器不支持canvas"});case 12:return s=d>1920?1920:d,l=m>1080?1080:m,k.width=s,k.height=l,(D=k.getContext("2d")).clearRect(0,0,s,l),P=s,F=l,D.save(),D.translate(s/2,l/2),O>j?O=I*(j=F):j=(O=P)/I,O>P?j=(O=P)/I:j>F&&(O=(j=F)*I),D.translate(-O/2,-j/2),D.drawImage(t,h,p,d,m,0,0,O,j),D.restore(),e.abrupt("return",{errcode:"0000",description:"success",data:k});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){if(e.length<=1)return e;for(var t=0;t<e.length-1;t++)for(var r=0;r<e.length-t-1;r++){var a=e[r],n=e[r+1],i=n.region||"";i=i.replace(/[[\]]/g,"").split(",");var c=parseInt(i[0]),s=parseInt(i[1]),u=a.region||"";u=u.replace(/[[\]]/g,"").split(",");var l=c-parseInt(u[0]),g=s-parseInt(u[1]),f=!1;if(l<0&&g<0?f=!0:l<0?f=!(g+l>0):g<0&&(f=!(g+l>50)),f){var h=o({},n);e[r+1]=o({},a),e[r]=h}}return e}function w(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=a(e),r=0;r<t.length;r++){var n=t[r],i=n.region||"";i=i.replace(/[[\]]/g,"").split(",");for(var o=parseInt(i[0]),c=parseInt(i[1]),s=parseInt(i[2]),u=parseInt(i[3]),l=0;l<t.length;l++)if(!(l<=r)){var g=t[l],f=g.region||"";f=f.replace(/[[\]]/g,"").split(",");var h=parseInt(f[0]),p=parseInt(f[1]),d=parseInt(f[2]),m=parseInt(f[3]);if(!(s<h||u<p)){var v=Math.abs((s>d?s:d)-(o<h?o:h)),b=Math.abs(s-o)+Math.abs(d-h),w=Math.abs((u>m?u:m)-(p<c?p:c)),y=Math.abs(u-c)+Math.abs(m-p),x=v-b,R=w-y;x>0||R>0||(R=Math.abs(R)/2+6,(x=Math.abs(x)/2+6)<R?(o<h?(i=[o,c,parseInt(i[2])-x,i[3]],f=[h+x,p,f[2],f[3]],s-=x,h+=x):(i=[o+x,c,i[2],i[3]],f=[h,p,parseInt(f[2])-x,f[3]],d-=x,o+=x),t[r].region=i.join(","),t[l].region=f.join(",")):(c<p?(i=[o,c,i[2],parseInt(i[3])-R],f=[h,p+R,f[2],f[3]],u-=R,p+=R):(i=[o,c+R,i[2],i[3]],f=[h,p,f[2],parseInt(f[3])-R],m-=R,c+=R),t[r].region=i.join(","),t[l].region=f.join(",")))}}}return t}function y(e){return x.apply(this,arguments)}function x(){return(x=u(regeneratorRuntime.mark((function e(t){var r,a,n,i,o,c,s,u,l,g,f,h,p,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:{},a=r.maxWidth,n=void 0===a?1920:a,i=r.maxHeight,o=void 0===i?1024:i,c=r.minWidth,s=r.minHeight,"function"==typeof(u=document.createElement("canvas")).getContext){e.next=5;break}return e.abrupt("return",{errcode:"unsport",description:"浏览器不支持canvas"});case 5:return l=t.width,g=t.height,f=d(0,l,g,n,o,0,c,s),h=f.rw,p=f.rh,u.width=h,u.height=p,(m=u.getContext("2d")).clearRect(0,0,u.width,u.height),m.save(),m.drawImage(t,0,0,l,g,0,0,h,p),m.restore(),e.abrupt("return",{errcode:"0000",description:"success",data:u});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return I.apply(this,arguments)}function I(){return(I=u(regeneratorRuntime.mark((function e(t,r){var a,n,i,o,c,s,u,l,g,f,h,p,m,v,b,y,x,R,I,O,j,k,D,P,F,S,C,M,L,W,H,U,z,T,E,A,_,B,X,Y,N,q,Q,$,G,J,K,V,Z;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.targetWidth,n=r.targetHeight,i=r.areaInfo,o=void 0===i?[]:i,c=r.clearCanvas,s=r.orientation,u=void 0===s?0:s,l=r.maxWidth,g=void 0===l?1920:l,f=r.maxHeight,h=void 0===f?1024:f,p=12,m=16,v=2,b=1,y=t.width,x=t.height,0!==o.length){e.next=9;break}return e.abrupt("return",{errcode:"argsErr",description:"标记区域为空"});case 9:if(void 0===c&&(c=!0),(R=document.createElement("canvas"))&&"function"==typeof R.getContext){e.next=13;break}return e.abrupt("return",{errcode:"unsport",description:"浏览器不支持canvas"});case 13:for(I=Math.abs(u)%360,O=d(I,y,x,g,h,0),j=O.rw,k=O.rh,D=R.getContext("2d"),P=0,F=0,S=0,C=0,M=y,L=x,(W=o[0].pixel)&&(H=W.split(","),y>x&&M<L||y<x&&M>L?(M=parseInt(H[1]),L=parseInt(H[0])):(M=parseInt(H[0]),L=parseInt(H[1]))),90===I||270===I?(R.width=k,R.height=j):(R.width=j,R.height=k),D.save(),D.clearRect(0,0,R.width,R.height),D.translate(R.width/2,R.height/2),D.rotate(-u*Math.PI/180),U=parseFloat(j/M),z=parseFloat(k/L),D.translate(-j/2,-k/2),D.drawImage(t,0,0,y,x,0,0,j,k),T=d(0,R.width,R.height,a,n,0),b=R.height/T.rh,p*=b,m*=b,v*=b,E=w(o),A=0;A<E.length;A++)_=E[A].region.replace(/[[\]]/g,"").split(","),E[A].region||(_=[0,0,y,x]),B=E[A].markColor||"#487BFB",X=E[A].lineColor||B,P=parseInt(_[0])*U,F=parseInt(_[1])*z,S=parseInt(_[2])*U-P,C=parseInt(_[3])*z-F,Y=parseInt(_[2])*U,N=parseInt(_[3])*z,S+P>j&&(S=j-P),C+F>k&&(C=k-F),D.save(),D.strokeStyle=X,D.lineWidth=v,"function"==typeof D.setLineDash&&D.setLineDash([10*b,10*b]),D.moveTo(P+v,F+v),D.beginPath(),D.strokeRect(P+v,F+v,S-2*v,C-2*v),D.stroke(),D.closePath(),D.restore(),D.save(),D.strokeStyle=B,D.beginPath(),q=P+p+v+2,Q=F+p+v+2,-90===u||270===u?Q=N-p-v-2:-180===u||180===u?(q=Y-p-v-2,Q=N-p-v-2):90!==u&&-270!==u||(q=Y-p-v-2),D.moveTo(q,Q),D.arc(q,Q,p,0,2*Math.PI,!1),D.closePath(),D.stroke(),D.fillStyle=B,D.fill(),D.restore();for($=0;$<E.length;$++)G=E[$].region.replace(/[[\]]/g,"").split(","),E[$].region||(G=[0,0,y,x]),P=parseInt(G[0])*U,F=parseInt(G[1])*z,J=parseInt(G[2])*U,K=parseInt(G[3])*z,V=P+p+v+2.3,Z=F+p+v+2.3,D.save(),D.font=m+"px Times New Roman",D.fillStyle="#fff",D.textAlign="center",D.textBaseline="middle",-90===u||270===u?Z=K-p-v-2.3:-180===u||180===u?(V=J-p-v-2.3,Z=K-p-v-2.3):90!==u&&-270!==u||(V=J-p-v-2.3),0!==u?(D.translate(V,Z),D.rotate(u*Math.PI/180),D.fillText($+1,0,0)):D.fillText($+1,V,Z),D.restore();return D.restore(),e.abrupt("return",{errcode:"0000",description:"success",data:R});case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r.r(t),r.d(t,"adjustSize",(function(){return l})),r.d(t,"loadImage",(function(){return g})),r.d(t,"base64ToFile",(function(){return f})),r.d(t,"normalize",(function(){return h})),r.d(t,"getRotateRect",(function(){return d})),r.d(t,"cuteImage",(function(){return m})),r.d(t,"sortByRegion",(function(){return b})),r.d(t,"adjuestRect",(function(){return w})),r.d(t,"showImage",(function(){return y})),r.d(t,"markImage",(function(){return R}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var a=r(1);function n(e,t,r,a,n,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(a,n)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function c(e){n(o,a,i,c,s,"next",e)}function s(e){n(o,a,i,c,s,"throw",e)}c(void 0)}))}}function o(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"modifyArgs",(function(e){r.displayFlag=e.displayFlag||r.displayFlag,r.width=e.width||r.width,r.height=e.height||r.height,r.emptyFillStyle=e.emptyFillStyle||r.emptyFillStyle,r.imgCanvasObj=null})),c(this,"computeDrawSize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.imgWidth,n=e.imgHeight,i=e.maxWidth,o=e.maxHeight,c=e.rotateDeg,s=void 0===c?r.rotateDeg:c,u=e.displayFlag,l=void 0===u?"showImage":u,g=e.resetLargerRatio,f=e.reset,h=void 0!==e.largerRatio?e.largerRatio:r.largerRatio,p=parseFloat(t/n),d=1*i/2,m=1*o/2;if(s!==r.rotateDeg||g||f){var v="markImage"===l?0:s,b=Object(a.getRotateRect)(v,t,n,i,o,0,d,m);r.rw=b.rw,r.rh=b.rh,r.rotateDeg=f?r.initRotateDeg:s,r.largerRatio=parseFloat(r.rw/t),r.initLargerRatio||(r.initLargerRatio=r.largerRatio)}else h!==r.largerRatio&&(r.largerRatio=h),r.rh=n*h,r.rw=r.rh*p})),c(this,"showImage",function(){var e=i(regeneratorRuntime.mark((function e(t){var n,i,o,c,s,u,l,g,f,h,p,d,m,v,b,w,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=y.length>1&&void 0!==y[1]?y[1]:{},i=n.resetLargerRatio,o=n.reset,c=n.largerRatio,s=void 0===c?r.largerRatio:c,u=void 0!==n.rotateDeg?n.rotateDeg:r.rotateDeg,u%=360,l=r.ctx.canvas.width,g=r.ctx.canvas.height,f=r.getOffset(u,n.offsetX,n.offsetY),h=f.offsetX,p=f.offsetY,u===r.rotateDeg&&r.imgCanvasObj){e.next=14;break}return e.next=10,Object(a.showImage)(t);case 10:if("0000"===(d=e.sent).errcode){e.next=13;break}return e.abrupt("return",d);case 13:r.imgCanvasObj=d.data;case 14:return m=r.ctx,v=r.imgCanvasObj.width,b=r.imgCanvasObj.height,r.computeDrawSize({imgWidth:v,imgHeight:b,maxWidth:l,maxHeight:g,rotateDeg:u,largerRatio:s,resetLargerRatio:i,reset:o}),w=m.canvas,m.save(),m.fillStyle=r.emptyFillStyle,m.clearRect(0,0,w.width,w.height),m.translate(w.width/2,w.height/2),m.rotate(-u*Math.PI/180),m.translate(-r.rw/2+h,-r.rh/2+p),m.drawImage(r.imgCanvasObj,0,0,v,b,0,0,r.rw,r.rh),m.restore(),e.abrupt("return",{errcode:"0000",data:{rotateDeg:r.rotateDeg,largerRatio:r.largerRatio}});case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c(this,"cuteImage",function(){var e=i(regeneratorRuntime.mark((function e(t){var n,i,o,c,s,u,l,g,f,h,p,d,m,v,b,w,y,x,R,I,O,j=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=j.length>1&&void 0!==j[1]?j[1]:{},i=n.resetLargerRatio,o=n.reset,c=n.largerRatio,s=void 0===c?r.largerRatio:c,u=n.areaInfo,l=void 0===u?[]:u,g=void 0!==n.rotateDeg?n.rotateDeg:r.rotateDeg,g%=360,f=l[0],h=f.pixel,p=f.region,d=r.ctx.canvas.width,m=r.ctx.canvas.height,g===r.rotateDeg&&r.imgCanvasObj){e.next=14;break}return e.next=10,Object(a.cuteImage)(t,{pixel:h,region:p});case 10:if("0000"===(v=e.sent).errcode){e.next=13;break}return e.abrupt("return",v);case 13:r.imgCanvasObj=v.data;case 14:return b=r.ctx,w=b.canvas,y=r.imgCanvasObj.width,x=r.imgCanvasObj.height,R=r.getOffset(g,n.offsetX,n.offsetY),I=R.offsetX,O=R.offsetY,r.computeDrawSize({imgWidth:y,imgHeight:x,maxWidth:d,maxHeight:m,rotateDeg:g,largerRatio:s,resetLargerRatio:i,reset:o}),b.save(),b.fillStyle=r.emptyFillStyle,b.clearRect(0,0,w.width,w.height),b.translate(w.width/2,w.height/2),b.rotate(-g*Math.PI/180),b.translate(-r.rw/2+I,-r.rh/2+O),b.drawImage(r.imgCanvasObj,0,0,y,x,0,0,r.rw,r.rh),b.restore(),e.abrupt("return",{errcode:"0000",data:{rotateDeg:r.rotateDeg,largerRatio:r.largerRatio}});case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c(this,"markImage",function(){var e=i(regeneratorRuntime.mark((function e(t){var n,i,o,c,s,u,l,g,f,h,p,d,m,v,b,w,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=y.length>1&&void 0!==y[1]?y[1]:{},i=n.resetLargerRatio,o=n.reset,c=n.offsetX,s=n.offsetY,u=n.largerRatio,l=void 0===u?r.largerRatio:u,g=n.areaInfo,f=void 0===g?[]:g,h=void 0!==n.rotateDeg?n.rotateDeg:r.rotateDeg,h%=360,p=r.ctx,d=p.canvas.width,m=p.canvas.height,h===r.rotateDeg&&r.imgCanvasObj){e.next=14;break}return e.next=10,Object(a.markImage)(t,{targetHeight:m,targetWidth:d,areaInfo:f,orientation:h});case 10:if("0000"===(v=e.sent).errcode){e.next=13;break}return e.abrupt("return",v);case 13:r.imgCanvasObj=v.data;case 14:return b=r.imgCanvasObj.width,w=r.imgCanvasObj.height,r.computeDrawSize({displayFlag:"markImage",imgWidth:b,imgHeight:w,maxWidth:d,maxHeight:m,rotateDeg:h,largerRatio:l,resetLargerRatio:i,reset:o}),p.save(),p.fillStyle=r.emptyFillStyle,p.clearRect(0,0,p.canvas.width,p.canvas.height),p.translate(p.canvas.width/2-r.rw/2+c,p.canvas.height/2-r.rh/2+s),p.drawImage(r.imgCanvasObj,0,0,b,w,0,0,r.rw,r.rh),p.restore(),e.abrupt("return",{errcode:"0000",data:{rotateDeg:r.rotateDeg,largerRatio:r.largerRatio}});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.ctx=t.ctx,this.width=t.width,this.height=t.height,this.initLargerRatio=t.largerRatio||1,this.initRotateDeg=t.rotateDeg||0,this.rotateDeg=this.initRotateDeg,this.largerRatio=this.initLargerRatio,this.emptyFillStyle=t.emptyFillStyle||"#D7DAE1"}var t,r,n;return t=e,(r=[{key:"getOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(90===e||-270===e){var a=r;r=t,t=-a}else if(-90===e||270===e){var n=r;r=-t,t=n}else 180!==e&&-180!==e||(r=-r,t=-t);return{offsetX:t,offsetY:r}}}])&&o(t.prototype,r),n&&o(t,n),e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"tempCompressImgFile",(function(){return u})),r.d(t,"compressImgFile",(function(){return g}));var a=r(1);function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,a,n,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(a,n)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var i=e.apply(t,r);function o(e){c(i,a,n,o,s,"next",e)}function s(e){c(i,a,n,o,s,"throw",e)}o(void 0)}))}}function u(e){return l.apply(this,arguments)}function l(){return(l=s(regeneratorRuntime.mark((function e(t){var r,n,o,c,s,u,l,g,f,h,p,d,m,v,b,w,y,x,R,I,O,j,k,D,P=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=P.length>1&&void 0!==P[1]?P[1]:{},n=r.localUrl||"",o=window.URL||window.webkitURL||window.mozURL||{},-1!==(t.type||"").indexOf("image/")&&"function"==typeof o.createObjectURL&&void 0!==r.fileLimitSize){e.next=6;break}return e.abrupt("return",{errcode:"0000",localUrl:n,file:t});case 6:if(c=r.fileLimitWidth,s=r.fileLimitHeight,!(u=r.fileLimitPixel)&&c&&s&&(u=c>s?s:c),u||(u=1500),l=r.fileQuality||.98,l=isNaN(parseFloat(l))?.98:parseFloat(l),""!==n){e.next=21;break}e.prev=13,n=o.createObjectURL(t),e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(13),window.console&&console.error(e.t0),e.abrupt("return",{errcode:"0000",localUrl:n,file:t});case 21:if(g=r.fileLimitSize,f=t.size,h=1024*parseFloat(g)*1024,!(f<=h)){e.next=26;break}return e.abrupt("return",{errcode:"0000",localUrl:n,file:t});case 26:return p=h/f,e.next=29,Object(a.loadImage)(n);case 29:if("0000"===(d=e.sent).errcode){e.next=32;break}return e.abrupt("return",{errcode:"0000",localUrl:n,file:t});case 32:if(m=d.data,v=m.width,b=m.height,w=m.imgObj,y={originWidth:v,originHeight:b,width:v,height:b,localUrl:n},!(v<u||b<u)){e.next=36;break}return e.abrupt("return",i(i({errcode:"0000"},y),{},{file:t}));case 36:x=v,R=b,I=v/b,v<=b?(R=Math.floor(b*p),x=Math.floor(R*I)):(x=Math.floor(v*p),R=Math.floor(x/I)),(x<u||R<u)&&(x<=R?(x=u,R=Math.floor(x/I)):(R=u,x=Math.floor(R*I))),y.width=x,y.height=R,e.prev=43,(j=document.createElement("canvas")).width=x,j.height=R,(k=j.getContext("2d")).clearRect(0,0,x,R),k.drawImage(w,0,0,x,R),O=j.toDataURL("image/jpeg",l),j=null,e.next=58;break;case 54:return e.prev=54,e.t1=e.catch(43),window.console&&console.error(e.t1),e.abrupt("return",i(i({errcode:"0000"},y),{},{file:t}));case 58:return e.next=60,Object(a.base64ToFile)(O,t.name);case 60:if(!("0000"!==(D=e.sent).errcode||D.data.size>t.size)){e.next=63;break}return e.abrupt("return",i(i({errcode:"0000"},y),{},{width:v,height:b,file:t}));case 63:return e.abrupt("return",i(i({errcode:"0000"},y),{},{file:D.data}));case 64:case"end":return e.stop()}}),e,null,[[13,17],[43,54]])})))).apply(this,arguments)}function g(e){return f.apply(this,arguments)}function f(){return(f=s(regeneratorRuntime.mark((function e(t){var r,a,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.prev=1,e.next=4,u(t,r);case 4:return a=e.sent,e.abrupt("return",a);case 8:e.prev=8,e.t0=e.catch(1),window.console&&console.error(e.t0);case 11:return n=r.localUrl||"",e.abrupt("return",{errcode:"0000",localUrl:n,file:t});case 13:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}}])}));